

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Using repo2docker as part of your Continuous Integration &#8212; repo2docker 0.10.0 documentation</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="../_static/sphinx-bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link href="../_static/css/custom.css" rel="stylesheet">
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Configuring your repository" href="../configuration/index.html" />
    <link rel="prev" title="Build JupyterHub-ready images" href="jupyterhub_images.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>

<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
</button>

<div id="navbar-menu" class="collapse navbar-collapse">
  <ul id="navbar-main-elements" class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="../index.html">Home</a>
    </li>
    
    
    <li class="nav-item ">
        <a class="nav-link" href="../getting-started/index.html">Getting Started</a>
    </li>
    
    <li class="nav-item active">
        <a class="nav-link" href="index.html">How-to Guides</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../configuration/index.html">Configuring your repository</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../contributing/index.html">Contributing</a>
    </li>
    
    <li class="nav-item ">
        <a class="nav-link" href="../changelog.html">Changelog</a>
    </li>
    
  </ul>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item">
      <a class="nav-link" href="https://github.com/pandas-dev/pandas" target="_blank" rel="noopener">
        <span><i class="fab fa-github-alt" style="color:#333;font-size:1rem;line-height:1.25"></i></span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="https://twitter.com/pandas_dev" target="_blank" rel="noopener">
        <span><i class="fab fa-twitter" style="color:#55acee;font-size:1rem;line-height:1.25"></i></span>
      </a>
    </li>
  </ul>
</div>
    </nav>

    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
              

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
        
          
              <li class="">
                  <a href="user_interface.html">Configure the user interface</a>
              </li>
          
        
          
              <li class="">
                  <a href="languages.html">Choose languages for your environment</a>
              </li>
          
        
          
              <li class="">
                  <a href="export_environment.html">How to automatically create a environment.yml that works with repo2docker</a>
              </li>
          
        
          
              <li class="">
                  <a href="lab_workspaces.html">Share JupyterLab Workspaces with a repository</a>
              </li>
          
        
          
              <li class="">
                  <a href="jupyterhub_images.html">Build JupyterHub-ready images</a>
              </li>
          
        
          
              <li class="active">
                  <a href="">Using repo2docker as part of your Continuous Integration</a>
              </li>
          
        
      
      
      
      
      
      
      
      
    </ul>

</nav>


              
          </div>

          <div class="d-none d-xl-block col-xl-2 bd-toc">
              

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#getting-started" class="nav-link">Getting Started</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-1-clone-the-repository" class="nav-link">Step 1. Clone the Repository</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-2-choose-your-configuration" class="nav-link">Step 2. Choose your Configuration</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-3-docker-hub" class="nav-link">Step 3. Docker Hub</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-4-connect-to-circleci" class="nav-link">Step 4. Connect to CircleCI</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-5-push-away-merrill" class="nav-link">Step 5. Push Away, Merrill!</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#step-5-use-your-container" class="nav-link">Step 5. Use Your Container!</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>
              
            </div>

          <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
              <div>
                
  <div class="section" id="using-repo2docker-as-part-of-your-continuous-integration">
<span id="deploy"></span><h1>Using <code class="docutils literal notranslate"><span class="pre">repo2docker</span></code> as part of your Continuous Integration<a class="headerlink" href="#using-repo2docker-as-part-of-your-continuous-integration" title="Permalink to this headline">¶</a></h1>
<p>We’ve created for you the <a class="reference external" href="https://www.github.com/binder-examples/continuous-build/">continuous-build</a>
repository so that you can push a <a class="reference external" href="https://docs.docker.com/">Docker</a> container
to <a class="reference external" href="https://hub.docker.com/">Docker Hub</a> directly from a GitHub repository
that has a Jupyter notebook. Here are instructions to do this.</p>
<div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<p>Today you will be doing the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Fork and clone the continuous-build GitHub repository to obtain the hidden <code class="docutils literal notranslate"><span class="pre">.circleci</span></code> folder.</p></li>
<li><p>Creating an image repository on Docker Hub</p></li>
<li><p>Connecting your repository to CircleCI</p></li>
<li><p>Push, commit, or create a pull request to trigger a build.</p></li>
</ol>
</div></blockquote>
<p>You don’t need to install any dependencies on your host to build the container, it will be done
on a continuous integration server, and the container built and available to you
to pull from Docker Hub.</p>
<div class="section" id="step-1-clone-the-repository">
<h3>Step 1. Clone the Repository<a class="headerlink" href="#step-1-clone-the-repository" title="Permalink to this headline">¶</a></h3>
<p>First, fork the <a class="reference external" href="https://www.github.com/binder-examples/continuous-build/">continuous-build</a> GitHub
repository to your account, and clone the branch via either:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://www.github.com/&lt;username&gt;/continuous-build</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone git@github.com:&lt;username&gt;/continuous-build.git</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-choose-your-configuration">
<h3>Step 2. Choose your Configuration<a class="headerlink" href="#step-2-choose-your-configuration" title="Permalink to this headline">¶</a></h3>
<p>The hidden folder <code class="docutils literal notranslate"><span class="pre">.circleci/config.yml</span></code> has instructions for <a class="reference external" href="https://circleci.com/dashboard/">CircleCI</a>
to automatically discover and build your repo2docker Jupyter notebook container.
The default template provided in the repository in this folder will do the most basic steps,
including:</p>
<ol class="arabic simple">
<li><p>Clone the repository with the notebook that you specify</p></li>
<li><p>Build a Docker image</p></li>
<li><p>Push the build image to Docker Hub</p></li>
</ol>
<p>This repository aims to provide templates for your use.
If you have a request for a new template, please
<a class="reference external" href="https://www.github.com/binder-examples/continuous-build/issues/">let us know</a>.
We will add templates as they are requested to do additional tasks like test containers, run
nbconvert, etc.</p>
<p>Thus, if I have a repository named <code class="docutils literal notranslate"><span class="pre">myrepo</span></code> and I want to use the default configuration on circleCI,
I would copy it there from the <code class="docutils literal notranslate"><span class="pre">continuous-build</span></code> folder. In the example below, I’m
creating a new folder called “myrepo” and then copying the entire folder there:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p myrepo</span>
<span class="go">cp -R continuous-build/.circleci myrepo/</span>
</pre></div>
</div>
<p>You would then logically create a GitHub repository in the “myrepo” folder,
add the circleci configuration folder, and continue on to the next steps.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd myrepo</span>
<span class="go">git init</span>
<span class="go">git add .circleci</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-docker-hub">
<h3>Step 3. Docker Hub<a class="headerlink" href="#step-3-docker-hub" title="Permalink to this headline">¶</a></h3>
<p>Go to <a class="reference external" href="https://hub.docker.com/">Docker Hub</a>, log in, and click the big blue
button that says “create repository” (not an automated build). Choose an organization
and name that you like (in the traditional format <code class="docutils literal notranslate"><span class="pre">&lt;ORG&gt;/&lt;NAME&gt;</span></code>), and
remember it! We will be adding it, along with your
Docker credentials, to be encrypted CircleCI environment variables.</p>
</div>
<div class="section" id="step-4-connect-to-circleci">
<h3>Step 4. Connect to CircleCI<a class="headerlink" href="#step-4-connect-to-circleci" title="Permalink to this headline">¶</a></h3>
<p>If you navigate to the main <a class="reference external" href="https://circleci.com/dashboard/">app page</a> you
should be able to click “Add Projects” and then select your repository. If you don’t
see it on the list, then select a different organization in the top left. Once
you find the repository, you can click the button to “Start Building” and accept
the defaults.</p>
<p>Before you push or trigger a build, let’s set up the following environment variables.
Also in the project interface on CirleCi, click the gears icon next to the project
name to get to your project settings. Under settings, click on the “Environment
Variables” tab. In this section, you want to define the following:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CONTAINER_NAME</span></code> should be the name of the Docker Hub repository you just created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_TAG</span></code> is the tag you want to use. If not defined, will use first 10 characters of commit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DOCKER_USER</span></code> and <code class="docutils literal notranslate"><span class="pre">DOCKER_PASS</span></code> should be your credentials (to allowing pushing)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPO_NAME</span></code> should be the full GitHub url (or other) of the repository with the notebook. This doesn’t have to coincide with the repository you are using to do the build (e.g., “myrepo” in our example).</p></li>
</ol>
<p>If you don’t define the <code class="docutils literal notranslate"><span class="pre">CONTAINER_NAME</span></code> it will default to be the repository where it is
building from, which you should only do if the Docker Hub repository is named equivalently.
If you don’t define either of the variables from step 3. for the Docker credentials, your
image will build but not be pushed to Docker Hub. Finally, if you don’t define the <code class="docutils literal notranslate"><span class="pre">REPO_NAME</span></code>
it will again use the name of the repository defined for the <code class="docutils literal notranslate"><span class="pre">CONTAINER_NAME</span></code>.</p>
</div>
<div class="section" id="step-5-push-away-merrill">
<h3>Step 5. Push Away, Merrill!<a class="headerlink" href="#step-5-push-away-merrill" title="Permalink to this headline">¶</a></h3>
<p>Once the environment variables are set up, you can push or issue a pull request
to see circle build the workflow. Remember that you only need the <code class="docutils literal notranslate"><span class="pre">.circleci/config.yml</span></code>
and not any other files in the repository. If your notebook is hosted in the same repository,
you might want to add these, along with your requirements.txt, etc.</p>
<div class="alert alert-primary">
<p class="admonition-title">Tip</p>
<p>By default, new builds on CircleCI will not build for
pull requests and you can change this default in the settings. You can easily add
filters (or other criteria and actions) to be performed during or after the build
by editing the <code class="docutils literal notranslate"><span class="pre">.circleci/config.yml</span></code> file in your repository.</p>
</div>
</div>
<div class="section" id="step-5-use-your-container">
<h3>Step 5. Use Your Container!<a class="headerlink" href="#step-5-use-your-container" title="Permalink to this headline">¶</a></h3>
<p>You should then be able to pull your new container, and run it! Here is an example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker pull &lt;ORG&gt;/&lt;NAME&gt;</span>
<span class="go">docker run -it --name repo2docker -p 8888:8888 &lt;ORG&gt;/&lt;NAME&gt; jupyter notebook --ip 0.0.0.0</span>
</pre></div>
</div>
<p>For a pre-built working example, try the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker pull vanessa/repo2docker</span>
<span class="go">docker run -it --name repo2docker -p 8888:8888 vanessa/repo2docker jupyter notebook --ip 0.0.0.0</span>
</pre></div>
</div>
<p>You can then enter the url and token provided in the browser to access your notebook. When you are done and need to stop and remove the container:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker stop repo2docker</span>
<span class="go">docker rm repo2docker</span>
</pre></div>
</div>
</div>
</div>
</div>


              </div>
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="jupyterhub_images.html" title="previous page">Build JupyterHub-ready images</a>
    <a class='right-next' id="next-link" href="../configuration/index.html" title="next page">Configuring your repository</a>

              </div>
          </main>

      </div>
    </div><script>
    // TOC sidebar - add "active" class to parent list
    //
    // Bootstrap's scrollspy adds the active class to the <a> link,
    // but for the automatic collapsing we need this on the parent list item.
    //
    // The event is triggered on "window" (and not the nav item as documented),
    // see https://github.com/twbs/bootstrap/issues/20086
    $(window).on("activate.bs.scrollspy", function(){
    var navLinks = document.querySelectorAll('#bd-toc-nav a');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.remove('active');
    }
    var navLinks = document.querySelectorAll('#bd-toc-nav a.active');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.add('active');
    }
    });

    /**
     * Use left and right arrow keys to navigate forward and backwards.
    */
    const LEFT_ARROW_KEYCODE = 37
    const RIGHT_ARROW_KEYCODE = 39

    const getPrevUrl = () => document.getElementById('prev-link').href
    const getNextUrl = () => document.getElementById('next-link').href
    const initPageNav = (event) => {
        const keycode = event.which

        if (keycode === LEFT_ARROW_KEYCODE) {
            window.location.href = getPrevUrl();
        } else if (keycode === RIGHT_ARROW_KEYCODE) {
            window.location.href = getNextUrl();
        }
    };

    var keyboardListener = false;
    $( document ).ready(() => {
        if (keyboardListener === false) {
            document.addEventListener('keydown', initPageNav)
            keyboardListener = true;
        }
    });
</script>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Project Jupyter.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.0.
    </div>
  </body>
</html>